@model NBL.Models.ViewModels.TransferProducts.ViewTransferIssueModel
@{
    ViewBag.Title = "Delivery";
    Layout = "~/Views/Shared/_UserLayoutPage.cshtml";
}

<section class="content">
    <p class="text-center text-green" style="font-weight:bolder;font-size:20px">Deliverable Issue Details</p>
    <div style="border: 1px dotted; padding: 10px;">

        <div class="row">

            <div class="col-md-6">
                
                <address>
                    <b> From : </b>@Model.FromBranch.BranchName<br/>
                    @Model.FromBranch.BranchAddress
                </address>
                

            </div>
            <div class="col-md-6">
                <address>
                    <b>To :</b> @Model.ToBranch.BranchName<br/>
                    @Model.ToBranch.BranchAddress
                </address>
            </div>


        </div>
        
        <section style="margin: 10px">


            <div class="col-md-6 col-md-offset-3" style="border: 1px solid;">
                @using (Html.BeginForm())
                {
                    <div class="form-horizontal">
                        <h2 class="text-center">Scan Product</h2>
                        <div class="form-group">
                            @Html.LabelFor(m => m.ProductCode, new {@class = "control-label col-md-2"})
                            <div class="col-md-10">
                                @Html.TextBoxFor(m => m.ProductCode, new { @class = "form-control", placeholder = "Alwasy keep pointer here..!!", autofocus = "" })
                                @Html.ValidationMessageFor(m => m.ProductCode, "", new { @class = "text-danger" })
                            </div>

                        </div>
                        <div class="form-group">
                            <div class="col-md-offset-2 col-md-10">
                                <input type="submit" value="Save" class="btn btn-info"/>
                                @*@Html.ActionLink("Process", "SaveProductToFactoryInventory",null,new {@class="btn btn-success"})*@
                                <button type="button" value="@Model.TransferIssue.TransferIssueId" class="btn btn-success" onclick="viewDetails(this)"> Delivery</button>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </section>

        <table id="table_deliverable_issue_details" class="display" style="border:1px solid black">
            <caption class="text-center text-green" style="font-weight:bolder;font-size:20px">Issued Product List</caption>

            <thead>
            <tr>
                <th>Product Name</th>
                <th>Quantity</th>
                <th>Product Code</th>
            </tr>
            </thead>

            <tbody>

            @foreach (var item in Model.TransferIssue.Products)
            {
                <tr>
                    <td>@item.ProductName</td>
                    <td>@item.Quantity</td>

                    <td>
                        @if (Model.ScannedBarCodes != null)
                        {
                            foreach (var p in Model.ScannedBarCodes.ToList().FindAll(n=>Convert.ToInt32(n.ProductCode.Substring(0,3))==item.ProductId))
                            {
                                @p.ProductCode<span>,</span>
                            }
                        }
                    </td>
                </tr>
            }
                   
            </tbody>
            <tfoot>
            <tr>
                <td style="text-align:right"><label>Total :</label></td>
                <td><label>@Model.TransferIssue.Products.Sum(n => n.Quantity)</label></td>
                <td></td>
            </tr>
            </tfoot>
        </table>
        <hr />
      

    </div>
    @Html.Partial("_ModalDeliveryPartialPage")

</section>

@section Scripts
{
    <script>

        $('#table_deliverable_issue_details').DataTable({
            "bPaginate": false,
            "bFilter": false,
            "bInfo": false
        });

    </script>

    <script>


        function SaveDeliveryInfo(id) {

            if (confirm("Are you sure to Save  this delivery info?")) {

                $("#saveDeliveryInfoForm").submit();
            } else {
                return false;// if it's a link to prevent post
            }

            return false;// if it's a link to prevent post


        }
    </script>
    
    
    <script>

        function viewDetails(transferIssueId) {

            $.ajax({
                type: "POST",
                url: "@Url.Action("ViewOrderDetails", "Delivery", new { area = "Factory" })",
                data: { transferIssueId: transferIssueId.value },
                success: function (response) {
                    $('#modalBody').html(response);
                    $('#showDeliveryModal').modal('show');
                }
            });
        }

    </script>
}
